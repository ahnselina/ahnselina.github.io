---
title: 清理Ceph环境
date: 2021-10-02 23:30:30
categories:
- 分布式存储
tags: [存储, Ceph, 清理]
---

![](https://z3.ax1x.com/2021/09/30/45zpp8.png)

<!-- more -->

本文主要介绍如何清理Ceph环境。  

## 清理Ceph环境步骤(debian系统)
### 非正常卸载
每台节点执行：
```
sudo su -
/etc/init.d/ceph  stop
或者
ps aux|grep ceph ｜grep -v grep |awk '{print $2}'|xargs kill -9
ps aux|grep ceph｜grep -v grep |awk '{print $2}'|xargs kill -9
rm -rf /var/lib/ceph/osd/*
rm -rf /var/lib/ceph/mon/*
rm -rf /var/lib/ceph/mds/*
rm -rf /var/lib/ceph/bootstrap-mds/*
rm -rf /var/lib/ceph/bootstrap-osd/*
rm -rf /var/lib/ceph/bootstrap-rgw/*
rm -rf /var/lib/ceph/bootstrap-mgr/*
rm -rf /var/lib/ceph/tmp/*
rm -rf /etc/ceph/*
rm -rf /var/run/ceph/*
列出 Ubuntu 和 Debian 上已安装的与Ceph相关的软件包：
apt list --installed | grep ceph
 删除Ceph相关的软件包：
apt-get autoremove --purge ceph
```

### 检查是否卸载干净：
```
dpkg -l | grep rados
如果还有继续卸载：
apt-get autoremove –purge librados2
```


### 正常卸载
如果是为了测试，搭建好的ceph环境而且是正常工作的，那么卸载之前安装环境。  
**查看命令帮助**
```
[root@ceph-mon1 ~]# ceph-deploy -h
uninstall:    
    Remove Ceph packages from remote hosts.(仅仅会卸载ceph软件包)
purge:       
    Remove Ceph packages from remote hosts and purge allData.(卸载ceph软件包而且还会清除所有数据)
Purgedata:   
    Purge (delete, destroy, discard, shred) any Ceph data from /var/lib/ceph(删除所有关于ceph的数据文件位于/var/lib/ceph下)
Forgetkeys:  
    Remove authentication keys from the local directory.(将卸载节点的认证密钥从本地目录移除)<br><br><br>示例：
```

一、安装ceph-deploy软件
```
dnf install ceph-deploy -y
```

二、软件环境：三个节点环境
```
#卸载ceph软件包
ceph-deploy purge controller1
ceph-deploy purge controller2
ceph-deploy purge controller3
 
#删除各种配置文件和生成的数据文件
#controller1上面执行
ceph-deploy purgedata controller1
#controller2上面执行
ceph-deploy purgedata controller2
#controller3上面执行
ceph-deploy purgedata controller3
 
#将卸载节点的认证密钥从本地目录移除

ceph-deploy forgetkeys<br><br>#检查ceph-mon是否启动
ps -ef|grep ceph  or ps -A|grep ceph<br><br>#启动ceph-mon
ceph-mon --id=1
```
 
三、软件环境：单节点环境
```
ceph-deploy purge controller1
ceph-deploy purgedata controller1
ceph-deploy forgetkeys
```

## 参考资料

