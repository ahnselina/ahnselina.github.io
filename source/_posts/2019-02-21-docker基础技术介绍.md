---
title: docker基础技术介绍
date: 2019-02-21 14:54:08
categories:
- 云计算
tags: [docker, 容器, namespace, cgroup]
---


![](http://wx4.sinaimg.cn/mw690/71c65545gy1g0e45m264hj20ic096q30.jpg)
<!-- more -->
本文主要介绍docker及其相关的技术，力求让大家读了此文和相关的参考资料之后就对docker技术有一个整体上的掌握，既可以作为入门阅读资料，又可以作为自己复习的资料 : )

### docker基础技术简介

Docker是近些年云计算领域非常热门的技术，可能很多人认为该技术非常新颖，但其实除了其编程语言用go比较新外，其实它还真不是个新东西，其中用到了许多linux的一些老的技术，下面就分别对用的技术做一个简介，目的是让大家对docker基础技术有一个了解，如果想深入研究请查阅相关的参考资料和源码。

容器技术使用了一系列的系统级别的机制诸如利用Linux namespaces来进行空间隔离，通过文件系统的挂载点来决定容器可以访问哪些文件，通过cgroups来确定每个容器可以利用多少资源。此外容器之间共享同一个系统内核，这样当同一个库被多个容器使用时，内存的使用效率会得到提升。
Docker 包括三个基本概念
* 镜像（Image）
* 容器（Container）
* 仓库（Repository）  

理解了这三个概念，就理解了 Docker 的整个生命周期。
这三个概念更多信息请参考：  
[基本概念](https://yeasy.gitbooks.io/docker_practice/basic_concept/)

#### Linux Namespace
Linux Namespace是Linux提供的一种内核级别环境隔离的方法 

Namespace解决的问题主要是环境隔离的问题，这只是虚拟化中最最基础的一步,我们还需要解决对计算机资源使用上的隔离。也就是说，虽然你通过Namespace把我Jail到一个特定的环境中去了，但是我在其中的进程使用用CPU、内存、磁盘等这些计算资源其实还是可以随心所欲的。所以，我们希望对进程进行资源利用上的限制或控制。这就是Linux CGroup出来了的原因。
更多详细信息请参考：  
[DOCKER基础技术：LINUX NAMESPACE（上）](https://coolshell.cn/articles/17010.html)  
[DOCKER基础技术：LINUX NAMESPACE（下）](https://coolshell.cn/articles/17029.html)  


#### Linux CGroup
 Linux CGroup全称Linux Control Group， 是Linux内核的一个功能，用来限制，控制与分离一个进程组群的资源（如CPU、内存、磁盘输入输出等）。这个项目最早是由Google的工程师在2006年发起（主要是Paul Menage和Rohit Seth），最早的名称为进程容器（process containers）。在2007年时，因为在Linux内核中，容器（container）这个名词太过广泛，为避免混乱，被重命名为cgroup，并且被合并到2.6.24版的内核中去。然后，其它开始了他的发展。  
更多信息请参考：  
[DOCKER基础技术：LINUX CGROUP](https://coolshell.cn/articles/17049.html) 


### 诞生背景
软件开发最大的麻烦事之一，就是环境配置。用户计算机的环境都不相同，你怎么知道自家的软件，能在那些机器跑起来？
用户必须保证两件事：操作系统的设置，各种库和组件的安装。只有它们都正确，软件才能运行。举例来说，安装一个 Python 应用，计算机必须有 Python 引擎，还必须有各种依赖，可能还要配置环境变量。
如果某些老旧的模块与当前环境不兼容，那就麻烦了。开发者常常会说："它在我的机器可以跑了"（It works on my machine），言下之意就是，其他机器很可能跑不了。
环境配置如此麻烦，换一台机器，就要重来一次，旷日费时。很多人想到，能不能从根本上解决问题，软件可以带环境安装？也就是说，安装的时候，把原始环境一模一样地复制过来。


#### 虚拟机
虚拟机（virtual machine）就是带环境安装的一种解决方案。它可以在一种操作系统里面运行另一种操作系统，比如在 Windows 系统里面运行 Linux 系统。应用程序对此毫无感知，因为虚拟机看上去跟真实系统一模一样，而对于底层系统来说，虚拟机就是一个普通文件，不需要了就删掉，对其他部分毫无影响。
虽然用户可以通过虚拟机还原软件的原始环境。但是，这个方案有几个缺点。  
（1）资源占用多
虚拟机会独占一部分内存和硬盘空间。它运行的时候，其他程序就不能使用这些资源了。哪怕虚拟机里面的应用程序，真正使用的内存只有 1MB，虚拟机依然需要几百 MB 的内存才能运行。  
（2）冗余步骤多  
虚拟机是完整的操作系统，一些系统级别的操作步骤，往往无法跳过，比如用户登录。  
（3）启动慢  
启动操作系统需要多久，启动虚拟机就需要多久。可能要等几分钟，应用程序才能真正运行。
#### Linux 容器
由于虚拟机存在这些缺点，Linux 发展出了另一种虚拟化技术：Linux 容器（Linux Containers，缩写为 LXC）。
Linux 容器不是模拟一个完整的操作系统，而是对进程进行隔离。或者说，在正常进程的外面套了一个保护层。对于容器里面的进程来说，它接触到的各种资源都是虚拟的，从而实现与底层系统的隔离。  
由于容器是进程级别的，相比虚拟机有很多优势。  
* 启动快

容器里面的应用，直接就是底层系统的一个进程，而不是虚拟机内部的进程。所以，启动容器相当于启动本机的一个进程，而不是启动一个操作系统，速度就快很多。
* 资源占用少

容器只占用需要的资源，不占用那些没有用到的资源；虚拟机由于是完整的操作系统，不可避免要占用所有资源。另外，多个容器可以共享资源，虚拟机都是独享资源。
* 体积小

容器只要包含用到的组件即可，而虚拟机是整个操作系统的打包，所以容器文件比虚拟机文件要小很多。
总之，容器有点像轻量级的虚拟机，能够提供虚拟化的环境，但是成本开销小得多。


### docker与虚拟化的区别
![](http://wx1.sinaimg.cn/mw690/71c65545gy1g0e45katj0j20j8079q33.jpg)
![](http://wx2.sinaimg.cn/mw690/71c65545gy1g0e45l99msj20j505ft8t.jpg)
上面的图片比较了 Docker 和传统虚拟化方式的不同之处。传统虚拟机技术是虚拟出一套硬件后，在其上运行一个完整操作系统，在该系统上再运行所需应用进程；而容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核，而且也没有进行硬件虚拟。因此容器要比传统虚拟机更为轻便。  

容器的实质是进程，但与直接在宿主执行的进程不同，容器进程运行于属于自己的独立的 命名空间。因此容器可以拥有自己的 root 文件系统、自己的网络配置、自己的进程空间，甚至自己的用户 ID 空间。容器内的进程是运行在一个隔离的环境里，使用起来，就好像是在一个独立于宿主的系统下操作一样。这种特性使得容器封装的应用比直接在宿主运行更加安全。也因为这种隔离的特性，很多人初学 Docker 时常常会混淆容器和虚拟机。  

对于系统虚拟化技术来说，虚拟层为用户提供了一个完整的虚拟机：包括内核在内的一个完整的系统镜像。CPU虚拟化技术可以为每个用户提供一个独享且和其他用户隔离的系统环境，虚拟层可以为每个用户分配虚拟化后的CPU、内存和IO设备资源。 
当然由上所述，可以知道虚拟机的隔离性还是要优于容器的。

更多docker相关的信息请查阅文末的参考资料。




### 参考资料：
[Docker 入门教程](http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html)  
[Docker — 从入门到实践](https://yeasy.gitbooks.io/docker_practice/)  
[DOCKER基础技术：LINUX NAMESPACE（上）](https://coolshell.cn/articles/17010.html)  
[DOCKER基础技术：LINUX NAMESPACE（下）](https://coolshell.cn/articles/17029.html)  
[DOCKER基础技术：LINUX CGROUP](https://coolshell.cn/articles/17049.html)   
[DOCKER基础技术：AUFS](https://coolshell.cn/articles/17061.html)  
[DOCKER基础技术：DEVICEMAPPER](https://coolshell.cn/articles/17200.html)

